#
# @lc app=leetcode id=1856 lang=python3
#
# [1856] Maximum Subarray Min-Product
#

# @lc code=start
class Solution:
    def maxSumMinProduct(self, nums: List[int]) -> int:
        left_smaller_index_stack = []
        left_smaller_index = []
        for i in range(len(nums)):
            while len(left_smaller_index_stack) and nums[left_smaller_index_stack[-1]] >= nums[i]:
                left_smaller_index_stack = left_smaller_index_stack[:-1]
            if len(left_smaller_index_stack):
                left_smaller_index.append(left_smaller_index_stack[-1])
            else:
                left_smaller_index.append(-1)
            left_smaller_index_stack.append(i)

        right_smaller_index_stack = []
        right_smaller_index = []
        for i in range(len(nums)-1, -1, -1):
            while len(right_smaller_index_stack) and nums[right_smaller_index_stack[-1]] >= nums[i]:
                right_smaller_index_stack = right_smaller_index_stack[:-1]
            if len(right_smaller_index_stack):
                right_smaller_index.append(right_smaller_index_stack[-1])
            else:
                right_smaller_index.append(len(nums))
            right_smaller_index_stack.append(i)
        right_smaller_index.reverse()

        pre_sum = [0]
        for i in range(len(nums)):
            pre_sum.append(pre_sum[-1] + nums[i])

        maximum = -1
        for i in range(len(nums)):
            left = left_smaller_index[i]+1 
            right = right_smaller_index[i]-1 
            total = pre_sum[right+1] - pre_sum[left]
            maximum = max(maximum, total * nums[i])
        return maximum % ((10**9)+7)

        
[3,3,2,2,3,1]
[18,69,23,33,48,46,9,65,2,81,60,15,8,85,55,30,72,78,79,31,80,25,77,63,100,68,95,71,67,97,40,6,61,1,24,42,91,32,52,37,26,59,83,16,20,19,43,17,35,51,47,36,92,27,89,76,98,7,66,11,28,99,39,73,56,4,88,87,12,75,86,90,96,44,82,14,34,41,3,38,5,10,58,21,29,84,74,62,13,93,70,45,49,64,53,22,54,94,57,50,10000000,9999999,9999998,9999997,9999996,9999995,9999994,9999993,9999992,9999991,9999990,9999989,9999988,9999987,9999986,9999985,9999984,9999983,9999982,9999981,9999980,9999979,9999978,9999977,9999976,9999975,9999974,9999973,9999972,9999971,9999970,9999969,9999968,9999967,9999966,9999965,9999964,9999963,9999962,9999961,9999960,9999959,9999958,9999957,9999956,9999955,9999954,9999953,9999952,9999951,9999950,9999949,9999948,9999947,9999946,9999945,9999944,9999943,9999942,9999941,9999940,9999939,9999938,9999937,9999936,9999935,9999934,9999933,9999932,9999931,9999930,9999929,9999928,9999927,9999926,9999925,9999924,9999923,9999922,9999921,9999920,9999919,9999918,9999917,9999916,9999915,9999914,9999913,9999912,9999911,9999910,9999909,9999908,9999907,9999906,9999905,9999904,9999903,9999902,9999901,9999900,9999899,9999898,9999897,9999896,9999895,9999894,9999893,9999892,9999891,9999890,9999889,9999888,9999887,9999886,9999885,9999884,9999883,9999882,9999881,9999880,9999879,9999878,9999877,9999876,9999875,9999874,9999873,9999872,9999871,9999870,9999869,9999868,9999867,9999866,9999865,9999864,9999863,9999862,9999861,9999860,9999859,9999858,9999857,9999856,9999855,9999854,9999853,9999852,9999851,9999850,9999849,9999848,9999847,9999846,9999845,9999844,9999843,9999842,9999841,9999840,9999839,9999838,9999837,9999836,9999835,9999834,9999833,9999832,9999831,9999830,9999829,9999828,9999827,9999826,9999825,9999824,9999823,9999822,9999821,9999820,9999819,9999818,9999817,9999816,9999815,9999814,9999813,9999812,9999811,9999810,9999809,9999808,9999807,9999806,9999805,9999804,9999803,9999802,9999801,9999800,9999799,9999798,9999797,9999796,9999795,9999794,9999793,9999792,9999791,9999790,9999789,9999788,9999787,9999786,9999785,9999784,9999783,9999782,9999781,9999780,9999779,9999778,9999777,9999776,9999775,9999774,9999773,9999772,9999771,9999770,9999769,9999768,9999767,9999766,9999765,9999764,9999763,9999762,9999761,9999760,9999759,9999758,9999757,9999756,9999755,9999754,9999753,9999752,9999751,9999750,9999749,9999748,9999747,9999746,9999745,9999744,9999743,9999742,9999741,9999740,9999739,9999738,9999737,9999736,9999735,9999734,9999733,9999732,9999731,9999730,9999729,9999728,9999727,9999726,9999725,9999724,9999723,9999722,9999721,9999720,9999719,9999718,9999717,9999716,9999715,9999714,9999713,9999712,9999711,9999710,9999709,9999708,9999707,9999706,9999705,9999704,9999703,9999702,9999701,9999700,9999699,9999698,9999697,9999696,9999695,9999694,9999693,9999692,9999691,9999690,9999689,9999688,9999687,9999686,9999685,9999684,9999683,9999682,9999681,9999680,9999679,9999678,9999677,9999676,9999675,9999674,9999673,9999672,9999671,9999670,9999669,9999668,9999667,9999666,9999665,9999664,9999663,9999662,9999661,9999660,9999659,9999658,9999657,9999656,9999655,9999654,9999653,9999652,9999651,9999650,9999649,9999648,9999647,9999646,9999645,9999644,9999643,9999642,9999641,9999640,9999639,9999638,9999637,9999636,9999635,9999634,9999633,9999632,9999631,9999630,9999629,9999628,9999627,9999626,9999625,9999624,9999623,9999622,9999621,9999620,9999619,9999618,9999617,9999616,9999615,9999614,9999613,9999612,9999611,9999610,9999609,9999608,9999607,9999606,9999605,9999604,9999603,9999602,9999601,9999600,9999599,9999598,9999597,9999596,9999595,9999594,9999593,9999592,9999591,9999590,9999589,9999588,9999587,9999586,9999585,9999584,9999583,9999582,9999581,9999580,9999579,9999578,9999577,9999576,9999575,9999574,9999573,9999572,9999571,9999570,9999569,9999568,9999567,9999566,9999565,9999564,9999563,9999562,9999561,9999560,9999559,9999558,9999557,9999556,9999555,9999554,9999553,9999552,9999551,9999550,9999549,9999548,9999547,9999546,9999545,9999544,9999543,9999542,9999541,9999540,9999539,9999538,9999537,9999536,9999535,9999534,9999533,9999532,9999531,9999530,9999529,9999528,9999527,9999526,9999525,9999524,9999523,9999522,9999521,9999520,9999519,9999518,9999517,9999516,9999515,9999514,9999513,9999512,9999511,9999510,9999509,9999508,9999507,9999506,9999505,9999504,9999503,9999502,9999501,9999500,9999499,9999498,9999497,9999496,9999495,9999494,9999493,9999492,9999491,9999490,9999489,9999488,9999487,9999486,9999485,9999484,9999483,9999482,9999481,9999480,9999479,9999478,9999477,9999476,9999475,9999474,9999473,9999472,9999471,9999470,9999469,9999468,9999467,9999466,9999465,9999464,9999463,9999462,9999461,9999460,9999459,9999458,9999457,9999456,9999455,9999454,9999453,9999452,9999451,9999450,9999449,9999448,9999447,9999446,9999445,9999444,9999443,9999442,9999441,9999440,9999439,9999438,9999437,9999436,9999435,9999434,9999433,9999432,9999431,9999430,9999429,9999428,9999427,9999426,9999425,9999424,9999423,9999422,9999421,9999420,9999419,9999418,9999417,9999416,9999415,9999414,9999413,9999412,9999411,9999410,9999409,9999408,9999407,9999406,9999405,9999404,9999403,9999402,9999401,9999400,9999399,9999398,9999397,9999396,9999395,9999394,9999393,9999392,9999391,9999390,9999389,9999388,9999387,9999386,9999385,9999384,9999383,9999382,9999381,9999380,9999379,9999378,9999377,9999376,9999375,9999374,9999373,9999372,9999371,9999370,9999369,9999368,9999367,9999366,9999365,9999364,9999363,9999362,9999361,9999360,9999359,9999358,9999357,9999356,9999355,9999354,9999353,9999352,9999351,9999350,9999349,9999348,9999347,9999346,9999345,9999344,9999343,9999342,9999341,9999340,9999339,9999338,9999337,9999336,9999335,9999334,9999333,9999332,9999331,9999330,9999329,9999328,9999327,9999326,9999325,9999324,9999323,9999322,9999321,9999320,9999319,9999318,9999317,9999316,9999315,9999314,9999313,9999312,9999311,9999310,9999309,9999308,9999307,9999306,9999305,9999304,9999303,9999302,9999301,9999300,9999299,9999298,9999297,9999296,9999295,9999294,9999293,9999292,9999291,9999290,9999289,9999288,9999287,9999286,9999285,9999284,9999283,9999282,9999281,9999280,9999279,9999278,9999277,9999276,9999275,9999274,9999273,9999272,9999271,9999270,9999269,9999268,9999267,9999266,9999265,9999264,9999263,9999262,9999261,9999260,9999259,9999258,9999257,9999256,9999255,9999254,9999253,9999252,9999251,9999250,9999249,9999248,9999247,9999246,9999245,9999244,9999243,9999242,9999241,9999240,9999239,9999238,9999237,9999236,9999235,9999234,9999233,9999232,9999231,9999230,9999229,9999228,9999227,9999226,9999225,9999224,9999223,9999222,9999221,9999220,9999219,9999218,9999217,9999216,9999215,9999214,9999213,9999212,9999211,9999210,9999209,9999208,9999207,9999206,9999205,9999204,9999203,9999202,9999201,9999200,9999199,9999198,9999197,9999196,9999195,9999194,9999193,9999192,9999191,9999190,9999189,9999188,9999187,9999186,9999185,9999184,9999183,9999182,9999181,9999180,9999179,9999178,9999177,9999176,9999175,9999174,9999173,9999172,9999171,9999170,9999169,9999168,9999167,9999166,9999165,9999164,9999163,9999162,9999161,9999160,9999159,9999158,9999157,9999156,9999155,9999154,9999153,9999152,9999151,9999150,9999149,9999148,9999147,9999146,9999145,9999144,9999143,9999142,9999141,9999140,9999139,9999138,9999137,9999136,9999135,9999134,9999133,9999132,9999131,9999130,9999129,9999128,9999127,9999126,9999125,9999124,9999123,9999122,9999121,9999120,9999119,9999118,9999117,9999116,9999115,9999114,9999113,9999112,9999111,9999110,9999109,9999108,9999107,9999106,9999105,9999104,9999103,9999102,9999101,9999100,9999099,9999098,9999097,9999096,9999095,9999094,9999093,9999092,9999091,9999090,9999089,9999088,9999087,9999086,9999085,9999084,9999083,9999082,9999081,9999080,9999079,9999078,9999077,9999076,9999075,9999074,9999073,9999072,9999071,9999070,9999069,9999068,9999067,9999066,9999065,9999064,9999063,9999062,9999061,9999060,9999059,9999058,9999057,9999056,9999055,9999054,9999053,9999052,9999051,9999050,9999049,9999048,9999047,9999046,9999045,9999044,9999043,9999042,9999041,9999040,9999039,9999038,9999037,9999036,9999035,9999034,9999033,9999032,9999031,9999030,9999029,9999028,9999027,9999026,9999025,9999024,9999023,9999022,9999021,9999020,9999019,9999018,9999017,9999016,9999015,9999014,9999013,9999012,9999011,9999010,9999009,9999008,9999007,9999006,9999005,9999004,9999003,9999002,9999001,9999000,9998999,9998998,9998997,9998996,9998995,9998994,9998993,9998992,9998991,9998990,9998989,9998988,9998987,9998986,9998985,9998984,9998983,9998982,9998981,9998980,9998979,9998978,9998977,9998976,9998975,9998974,9998973,9998972,9998971,9998970,9998969,9998968,9998967,9998966,9998965,9998964,9998963,9998962,9998961,9998960,9998959,9998958,9998957,9998956,9998955,9998954,9998953,9998952,9998951,9998950,9998949,9998948,9998947,9998946,9998945,9998944,9998943,9998942,9998941,9998940,9998939,9998938,9998937,9998936,9998935,9998934,9998933,9998932,9998931,9998930,9998929,9998928,9998927,9998926,9998925,9998924,9998923,9998922,9998921,9998920,9998919,9998918,9998917,9998916,9998915,9998914,9998913,9998912,9998911,9998910,9998909,9998908,9998907,9998906,9998905,9998904,9998903,9998902,9998901,9998900,9998899,9998898,9998897,9998896,9998895,9998894,9998893,9998892,9998891,9998890,9998889,9998888,9998887,9998886,9998885,9998884,9998883,9998882,9998881,9998880,9998879,9998878,9998877,9998876,9998875,9998874,9998873,9998872,9998871,9998870,9998869,9998868,9998867,9998866,9998865,9998864,9998863,9998862,9998861,9998860,9998859,9998858,9998857,9998856,9998855,9998854,9998853,9998852,9998851,9998850,9998849,9998848,9998847,9998846,9998845,9998844,9998843,9998842,9998841,9998840,9998839,9998838,9998837,9998836,9998835,9998834,9998833,9998832,9998831,9998830,9998829,9998828,9998827,9998826,9998825,9998824,9998823,9998822,9998821,9998820,9998819,9998818,9998817,9998816,9998815,9998814,9998813,9998812,9998811,9998810,9998809,9998808,9998807,9998806,9998805,9998804,9998803,9998802,9998801,9998800,9998799,9998798,9998797,9998796,9998795,9998794,9998793,9998792,9998791,9998790,9998789]
