#
# @lc app=leetcode id=2537 lang=python3
#
# [2537] Count the Number of Good Subarrays
#

# @lc code=start
class Solution:
    def countGood(self, nums: List[int], k: int) -> int:
        cnt = 0
        counter = {}
        left = 0
        pair_cnt = 0
        # slding window, O(n^2)
        for right in range(len(nums)):
            if nums[right] in counter:
                # count element
                counter[nums[right]][0] += 1

                # count pair cnt
                pair_cnt -= counter[nums[right]][1]
                counter[nums[right]][1] = (counter[nums[right]][0] * (counter[nums[right]][0]-1))//2
                pair_cnt += counter[nums[right]][1]
            else:
                counter[nums[right]] = [1, 0]
            
            while pair_cnt >= k:
                # count the result that start from left element to the nums end
                cnt += len(nums) - right

                # pop left
                counter[nums[left]][0] -=1

                # count pair_cnt
                pair_cnt -= counter[nums[left]][1]
                counter[nums[left]][1] = (counter[nums[left]][0] * (counter[nums[left]][0]-1))//2
                pair_cnt += counter[nums[left]][1]
                left += 1
        return cnt
# @lc code=end
[3,1,4,3,2,2,4]\n2
[2925982,2992609,3220822,2127958,7181050,4815650,2144017,689712,7812753,4953196,2239887,2637896,2439437,9262365,2545584,7378103,681045,6505644,4637312,3526362,5295267,7322112,4782442,2220932,2934536,1136160,405375,6605493,4723526,126234,7704267,7366210,6770877,103379,3704419,1040323,4692921,3362728,5315557,26785,917853,7768322,7774034,9653028,5557722,7913677,5279824,6066468,2181581,9102195,2369422,3903706,348406,6863578,410982,4728612,228063,7337937,4804865,5937477,7919018,5913197,5739681,7354789,1874331,4390492,5855661,8304181,4318232,8642090,6315312,5061498,1103376,5031480,7697722,8016691,3367827,5979501,222670,2306877,8287129,3312585,4779030,9210745,9695030,2578778,2243673,1679493,5521003,7215702,7901345,6624620,118236,3977044,4743501,201699,1708316,548573,4765115,2262388,1723930,6310612,9679532,8172907,7164904,390836,9441644,2715180,5936377,441322,9311859,4587069,6080104,7876810,1098574,4341535,7135503,4240683,4973165,5999455,6706242,9789080,5513457,2622240,6456537,8496446,3960890,6725910,1250947,3959294,5358072,6947852,8663019,5987026,8376672,4479710,1281875,2984467,9214558,5779326,9214853,2909874,896486,8210052,7984034,6150799,3067570,4048312,8824236,6405448,5891463,7771089,5685988,667978,2050254,6704262,565256,2490532,1167226,6810032,7124456,9488920,7429319,3193564,8244491,2274478,4175634,9738277,9171339,3235112,8326157,5981335,8335937,3641071,4085871,4480459,529829,6205385,6415981,8180037,9833248,7987923,6852439,6174178,4806424,5337037,58571,3956305,9869189,2617677,6315093,1975061,134453,9985542,1318500,3198727,7718853,2205207,9742135,5248623,95796,1501215,5703482,7015931,9235147,5278170,6441666,7861506,5080857,1115493,2342608,703700,1130093,3379164,8707318,4159112,8709980,2455372,1474456,5054358,1149404,2664702,5004484,4886706,2799613,5973270,9805620,3131005,9320209,3785394,9137045,7631555,9022908,272777,5900509,5773076,8239969,2264025,3497940,5813736,8091540,9308847,8035832,1270831,8422870,7849560,5039491,7525649,7807191,8747615,8005389,8773175,6130433,5347531,4627851,2652027,7379395,1288589,3707349,7081565,437185,906806,4183164,4385247,5075387,4749840,2813252,3268612,8798260,4073793,6786202,3416656,6945239,5818910,9483477,8631637,1331624,5725188,510194,2983803,7437038,6504898,1469894,7713738,9332848,8900171,8390807,1898118,4179639,7190432,4012742,7801139,7308477,8393516,744914,5125073,7224413,7352456,2113840,9681342,3622787,8853854,1562086,4359546,850073,577433,4275891,9964039,1200299,6109853,5342076,9593751,1467627,6071148,4813384,577371,2717306,1574067,2751029,6320228,4491320,3778895,1199111,9674981,556963,4785765,7577090,9047067,1702290,9057408,8712083,9391570,9460432,5473817,7064789,864257,5982569,5824845,2331373,2586302,2635713,1893573,9503831,5940370,9197479,4685033,2431497,1249755,237419,5606385,7132163,7639822,5123426,2361094,5299363,67312,4066088,9186891,4733374,7649986,8170243,5999774,690608,1374403,8157189,9484298,6519120,6983792,2198299,4742236,1569801,8618099,7999889,8576425,5975861,7290513,3415604,7379214,6771983,3423667,5496224,5526492,5413725,4728930,3998622,6261208,6953102,6610962,831303,7958372,6841328,816562,2612674,5815296,8887635,6333175,1988212,5018990,9194640,869127,7124,9835552,9540770,8290011,399106,8726847,1411311,6024001,3132720,2867563,3088446,8177422,1143503,9313299,9920226,6228400,1955093,9737097,110036,8006808,8703507,8268503,1709203,8383503,6332406,8374328,2217144,4204432,3748481,2581996,7318475,3542231,5255952,3960653,3226585,1322364,899925,3704619,8829579,7965466,2531087,6068691,6611345,8066635,9630669,8583599,5087972,7659047,483209,9440768,3791231,355457,7087313,801314,3767892,9132548,8758687,8918297,2700826,5114388,1758932,2039476,1586316,7709289,2203909,9422621,3209424,4730551,3267118,2198992,5261487,9164282,8232553,8224863,9760666,1491216,3662456,1011373,7629578,546612,2451392,855962,2870945,1855193,3926817,428515,7679980,4255555,4710126,5033819,1447544,1824250,8397212,1575567,7421919,423042,1068881,4433322,7899706,8662412,3852994,9345049,363118,7890681,227955,534007,1780367,1514970,5498998,6610907,6333580,3033081,7881554,8509075,8553745,5691522,745946,8704337,9090529,7215847,809391,9352292,8280546,1112798,22769,9029555,1813365,4155426,5493288,8135582,7867781,7454605,3872873,6359172,7525233,1622846,5801516,3236540,8048186,998306,6884741,8556424,1983875,9785776,2938041,8744070,2449826,4427524,9149295,4421145,3852533,3041743,724220,5722652,77082,6670636,9556727,4303804,621820,2733440,9637807,9009483,9627838,5117102,4796408,8074835,5640478,6197892,7595189,1073452,2237290,4584091,7640621,5831534,9230368,6819902,6882028,1051414,4424835,3120202,3316093,7055412,7897322,5466389,3700297,1352412,9307695,7068038,8351926,6116653,4899606,2906583,5463437,776659,6929038,3924941,5340164,9722196,6239214,9803588,646910,7703016,4234318,2328810,2792551,1039762,3183836,8637266,3127298,2406433,5152730,4689303,2727359,8211714,7732808,3726644,6479192,2949177,6988423,6611589,6493653,1811189,8343124,6130056,7659476,4515353,2944935,4021158,9746673,6863724,3491426,9208121,9098890,1421790,1286821,4829465,1169281,9526617,8530620,9411256,3352294,7614706,3377004,5505120,8733718,620591,50250,8095699,9335425,6592374,895738,3374035,2406471,9056409,7487351,7152251,4816544,2623650,7724580,3257013,8044886,9721220,349296,7816524,7446240,6542243,7836237,9769113,6574398,7518654,8244084,2456650,1110169,1850415,5257149,5053988,7575624,3392177,4159420,7857522,4332307,6798776,103851,3353509,278430,2316143,252918,1924842,1293892,6549874,7607833,5904420,4437869,8617632,1905836,6283631,695540,1059105,4613869,436548,4586028,6583387,2404247,3024414,7920838,5672745,507423,3720879,710815,7968755,8693417,9914231,2910030,7892105,8846808,934200,7474360,4469984,6666677,4410823,3969150,8063300,2244568,4952939,2984185,9510785,6069735,3247578,78514,6201999,6096869,5617113,9571052,3085686,3924009,1869198,6083849,3319100,9151986,3885241,1430900,7579970,6856485,1503733,7629999,3928488,5056297,5012653,5127328,7141085,6757541,7240778,1875469,7098318,3095117,2769045,5439518,2972435,8968323,1906368,2561353,4640220,8590694,2315468,5190027,6042497,854258,3180840,6393261,2979619,2287762,8664621,760318,2392205,9342917,4239413,5043431,9045153,676965,7518167,4263400,7909079,7315198,1593225,599054,5912032,6736991,896025,4097891,5776255,7873159,1218766,6012280,210830,2245130,5993904,7175619,9218820,6040149,1488089,808715,9523552,5355117,6131612,1190778,4809829,9265947,6221953,3830522,9662607,1139214,2918554,4316012,6414321,6421754,2816356,6168248,6004098,129811,1474256,6038327,6507915,9379424,5619047,1280432,2266052,7586856,3042996,7309516,7496314,6250342,4260667,7664033,873410,186935,9040065,6812197,2714898,4114839,2999680,4714808,9600371,561050,9887611,9468757,425597,9870083,1621981,5145879,98360,218275,7661854,8245375,116119,3840815,1100773,9701374,4150988,1882306,5343119,7030126,1349001,5379978,6966548,5146305,4954593,2480617,327404,3306167,8683872,3581632,1608675,4390558,6866903,4420090,8451494,9222636,5570094,2225098,8173331,6301390,4521180,3915087,8568031,5428341,2814727,3414587,6359955,2240545,3033165,5322678,4428653,4026833,6774456,7470163,7587056,6983884,9695233,3932431,4925931,3680772,8196800,7718311,2277084,6793377,676767,1037862,4978664,16941,9604344,7000019,5671808,7065993,4693250,6339623,7277434,4969470,7821428,6462242,5969516,9570138,2394873,3393950,3558561,9446569,9534826,3296068,995999,5000488,7055714,4571473,9331493,4422539,4348116,2833112,7215265,6464919,7358708,1658659,8810798,2996373,2692921,5685970,811158,9901189,237633,1932529,8417155,8208205,803312,3723561,1372911,3327177,3366442,7469472,7898740,7958565,5789785,7261327,3999910,7017266,7946405,2715356,656502,9981377,8875065,8801489,2405778,5270053,1123904,2003297,7763280,3368385,1128830,1778390,4594757,6919822,6059555,182642,5724516,8159163,5076224,8547725,8540940,8630769,3870136,2295032,3350515,6702639,8127731,5585594,5071562,5629739,9520102,7258898,6986597,8119631,9408128,4849571,2246982,7589565,4616967,1147766,7049022,8696954,3351857,4063549,367205,5415591,1103491,7615682,1237166,9526943,717140,6461418,9236919,6030361,3393904,8207332,4200207,7135440,5205574,8741352,7438637,7505149,3798662,7825626,8524038,9916822,7716806,4090926,2750074,8441777,2956424,4451536,1069857,6146712,7343476,8336192,7973064,4096146,7582284,6560426,5854930,970383,3127595,5723855,3104878,6088834,1579933,4899902,8480491,6890222,8793302,5000320,6421447,7699471,4770815,3267133,1664408,9150317,1664573,7850262,9367312,631086,2818126,1066579,8082523,2518446,2994757,8457284,6118664,8395552,3785841,1297689,9958233,7298258,8132539,7585214,8885142,4207697,7010800,2081185,7128461,9055985,2795200,2447328,3238812,4184883,8910795,4789987,8571297,4950863,1094437,122917,5563464,7401180,1995651,2055869,9983459,2405665,892223,508427,7250964,4380300,6875353,9100089,8875604,1757577,6133554,3001216,9793719,1807060,7436102,1936486,3716660,3511119,475732,949132,9351864,6254646,8209859,4720970,6509267,4020581,9946052,6575421,1683893,4293783,4428853,5995501,4462055,4932901,1380545,3304775,1543865,2695419,7750775,3381710,8582776,4120976,1203920,5567426,4734337,3504196,8882145,1532383,6058045,7911265,4842145,1035981,9157690,8972173,5664919,2323297,8499962,1850658,8221062,796062,1393091,7286521,9037513,538945,391598,4057715,6209789,4387394,564063,6118367,3553946,9194093,6785221,5413207,3338931,2947086,5504233,9112097,9330759,5333098,876815,8858894,8336311,7991092,1997965,3980402,4137469,6475719,4991609,5393037,9730274,2695938,2792327,3792223,7854959,2512175,1322171,3127115,9742721,4763540,5112447,9405352,5002867,9714371,130349,4244062,7691402,1148272,5088127,5895882,136730,65431,1242932,23368,5525598,3088076,4768439,2673574,5008936,4413855,1222530,366903,7303232,7502523,1750148,9086894,5829536,5855921,1555641,5509300,4089672,9916751,5203732,7709646,1149171,9293040,3985694,5579222,8200721,3653652,7046430,3168900,1187959,5770954,3826536,1395685,3642806,8700033,6274763,5331794,1749864,1958610,6716107,5944941,8077624,7693569,2744493,7242918,9718638,2494855,3828376,1026853,3385333,8255160,4963870,3676540,4394491]